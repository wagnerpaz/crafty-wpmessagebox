{"ts":1358126786816,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\r\n * Crafty WPMessagebox\r\n * Version 1.0\r\n *\r\n * Copyright 2013, Wagner Paz <wagner.o.paz@gmail.com>\r\n * Dual licensed under the MIT or GPL licenses.\r\n * \r\n * @trigger WPMessageBoxClosed - When the message box is closed\r\n */\r\nCrafty.c(\"WPMessageBox\",\r\n{\r\n\tinit: function()\r\n\t{\r\n\t\tthis.requires(\"2D\");\r\n\t}\r\n,\r\n\t/**@\r\n\t* #.messageBox\r\n\t* @comp WPMessageBox\r\n\t* @sign public this.messageBox(String[] text, Object style)\r\n\t* @param text  - Each element of the array will be a frame in the message box. To break line use '\\n'.\r\n\t* @param style - An object with a set of properties to customize the message box. See _processStyle(style).\r\n\t* \r\n\t* Create a customized message box showing the text in a typewriter style.\r\n\t* \r\n\t* @example\r\n\t* ~~~\r\n\t* Crafty.e(\"2D, DOM, WPMessageBox\")\r\n\t*       .attr({x: 10, y:10, w: 350, h: 70})\r\n\t*       .messageBox([\"Hello!\\nHow are you doing?\", \"I'm fine, and you?\"],\r\n\t*                   {borderSize: 3, font: {size: '12px'}});\r\n\t* ~~~\r\n\t*/\r\n\tmessageBox: function(text, style)\r\n\t{\r\n\t\tthis._text     = text;\r\n\t\tthis._style    = style = this._processStyle(style);\r\n\t\tthis._txtIndex = 0;\r\n\t\t\r\n\t\tthis._createNextIndicator();\r\n\t\tthis._createBackground();\r\n\t\tthis._createBorders();\r\n\t\tthis._createAndWriteText();\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n,\r\n\tnext: function()\r\n\t{\r\n\t\tthis._nextIndicator.blinkStop();\r\n\t\t\r\n\t\tif(this._txt.finished)\r\n        {\r\n            if(this._txtIndex < this._text.length)\r\n            {\r\n                this._createAndWriteText();\r\n            }\r\n            else\r\n            {\r\n                this._background.destroy();\r\n                this._destroyBorders();\r\n                this._nextIndicator.destroy();\r\n                this._txt.destroy();\r\n                \r\n                this.trigger(\"WPMessageBoxClosed\");\r\n                \r\n                this.destroy();\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this._txt.skipped = true;\r\n        }\r\n\t}\r\n,\r\n\t_createAndWriteText: function()\r\n\t{\r\n        if(this._txt !== undefined)\r\n        {\r\n            this.detach(this._txt);\r\n            this._txt.destroy();\r\n        }\r\n        \r\n        //CREATE THE TEXT ENTITY\r\n\t\tthis._txt = Crafty.e(\"2D, DOM, WPTypewriter\")\r\n                          .attr({x: this._x + (2 * this._style.borderSize) + this._style.padding,\r\n                                 y: this._y + (2 * this._style.borderSize) + this._style.padding,\r\n                                 w: this._w - (2 * this._style.borderSize) - this._style.padding,\r\n                                 h: this._h - (2 * this._style.borderSize) - this._style.padding,\r\n                                 z: this._z + 1})\r\n                          .textColor(this._style.foreground)\r\n                          .css({'font-family': this._style.font.family,\r\n                                'font-size'  : this._style.font.size,\r\n                                'font-weight': this._style.font.weight})\r\n                          .write(this._text[this._txtIndex++], null, 75, 40)\r\n                          .bind(\"WPTypewriterFinished\", function()\r\n                          {\r\n                              this._parent._nextIndicator.blinkStart();\r\n                          });\r\n\t\tthis.attach(this._txt);\r\n\t}\r\n,\r\n\t_createBackground: function()\r\n\t{\r\n\t\tthis._background = Crafty.e(\"2D, WPDynamicRender\")\r\n                                 .dynamicRender(this)\r\n                                 .attr({x: this._x + this._style.borderSize + this._style.margin,\r\n                                        y: this._y + this._style.borderSize + this._style.margin,\r\n                                        w: this._w - (2 * this._style.borderSize ) - (2 * this._style.margin),\r\n                                        h: this._h - (2 * this._style.borderSize ) - (2 * this._style.margin)});\r\n\t\tthis.attach(this._background);\r\n        if(this._style.background !== undefined && this._style.background !== '' && this._style.background != \"transparent\")\r\n\t\t{\r\n\t\t\tthis._background.addComponent(\"Color\");\r\n\t\t\t\r\n\t\t\t//IF THE MESSAGEBOX RENDER TYPE IS CANVAS THEN GIVE SUPPORT TO ALPHA STYLE\r\n\t\t\tif(this._background.__c[\"Canvas\"])\r\n\t\t\t{\r\n\t\t\t\tthis._background.addComponent(\"Tint\").tint(this._style.background, this._style.alpha);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t//OTHERWISE USE A SOLID COLOR\r\n\t\t\t{\r\n\t\t\t\tthis._background.color(this._style.background);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n,\r\n\t_createNextIndicator: function()\r\n\t{\r\n\t\tthis._nextIndicator = Crafty.e(\"2D, WPDynamicRender, Color, WPBlink\")\r\n                                    .dynamicRender(this)\r\n                                    .attr({x: this._x + this._w - this._style.borderSize - this._style.nextIndicatorSize - this._style.nextIndicatorMargin,\r\n                                           y: this._y + this._h - this._style.borderSize - this._style.nextIndicatorSize - this._style.nextIndicatorMargin,\r\n                                           w: this._style.nextIndicatorSize,\r\n                                           h: this._style.nextIndicatorSize,\r\n                                           z: this._z + 1,\r\n                                           alpha: 0.0})\r\n                                    .color(this._style.foreground)\r\n                                    .blink(400, 1.0, false)\r\n                                    ;\r\n\t\tthis.attach(this._nextIndicator);\r\n\t\t\r\n\t\tif(this._nextIndicator.__c[\"DOM\"])\r\n\t\t{\r\n\t\t\tthis.css('display', 'none');\r\n\t\t}\r\n\t}\r\n,\r\n\t_createBorders: function()\r\n\t{\r\n\t\tif(this._style.borderSize !== null && this._style.borderSize > 0)\r\n\t\t{\r\n\t\t\tthis.cornerNW = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                      .dynamicRender(this)\r\n\t\t\t                      .attr({x: this._x,\r\n\t\t\t                             y: this._y,\r\n\t\t\t                             w: this._style.borderSize,\r\n\t\t\t                             h: this._style.borderSize,\r\n\t\t\t                             z: this._z + 1})\r\n\t\t\t                      .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.cornerNW);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.cornerNW.addComponent(\"Image\").image(this._style.borderSkin + \"/corner-nw.png\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.cornerNE = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                      .dynamicRender(this)\r\n\t\t\t                      .attr({x: this._x + this._w - this._style.borderSize,\r\n\t\t\t                             y: this._y,\r\n\t\t\t                             w: this._style.borderSize,\r\n\t\t\t                             h: this._style.borderSize,\r\n\t\t\t                             z: this._z + 1})\r\n\t\t\t                      .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.cornerNE);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.cornerNE.addComponent(\"Image\").image(this._style.borderSkin + \"/corner-ne.png\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.cornerSW = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                      .dynamicRender(this)\r\n\t\t\t                      .attr({x: this._x,\r\n\t\t\t                             y: this._y + this._h - this._style.borderSize,\r\n\t\t\t                             w: this._style.borderSize,\r\n\t\t\t                             h: this._style.borderSize,\r\n\t\t\t                             z: this._z + 1})\r\n\t\t\t                      .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.cornerSW);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.cornerSW.addComponent(\"Image\").image(this._style.borderSkin + \"/corner-sw.png\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.cornerSE = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                      .dynamicRender(this)\r\n\t\t\t                      .attr({x: this._x + this._w - this._style.borderSize,\r\n\t\t\t                             y: this._y + this._h - this._style.borderSize,\r\n\t\t\t                             w: this._style.borderSize,\r\n\t\t\t                             h: this._style.borderSize,\r\n\t\t\t                             z: this._z+1})\r\n\t\t\t                      .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.cornerSE);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.cornerSE.addComponent(\"Image\").image(this._style.borderSkin + \"/corner-se.png\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.edgeN = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                   .dynamicRender(this)\r\n\t\t\t                   .attr({x: this._x + this._style.borderSize,\r\n\t\t\t                          y: this._y, \r\n\t\t\t                          w: this._w - (this._style.borderSize * 2),\r\n\t\t\t                          h: this._style.borderSize,\r\n\t\t\t                          z: this._z + 1})\r\n\t\t\t                   .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.edgeN);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.edgeN.addComponent(\"Image\").image(this._style.borderSkin + \"/edge-n.png\", \"repeat-x\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.edgeE = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                   .dynamicRender(this)\r\n\t\t\t                   .attr({x: this._x + this._w - this._style.borderSize,\r\n\t\t\t                          y: this._y + this._style.borderSize,\r\n\t\t\t                          w: this._style.borderSize,\r\n\t\t\t                          h: this._h - (2 * this._style.borderSize),\r\n\t\t\t                          z: this._z + 1})\r\n\t\t\t                   .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.edgeE);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.edgeE.addComponent(\"Image\").image(this._style.borderSkin + \"/edge-e.png\", \"repeat-y\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.edgeS = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                   .dynamicRender(this)\r\n\t\t\t                   .attr({x: this._x + this._style.borderSize,\r\n\t\t\t                          y: this._y + this._h - this._style.borderSize,\r\n\t\t\t                          w: this._w - (this._style.borderSize * 2),\r\n\t\t\t                          h: this._style.borderSize,\r\n\t\t\t                          z: this._z + 1})\r\n\t\t\t                   .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.edgeS);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.edgeS.addComponent(\"Image\").image(this._style.borderSkin + \"/edge-s.png\", \"repeat-x\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.edgeW = Crafty.e(\"2D, WPDynamicRender, Color\")\r\n\t\t\t                   .dynamicRender(this)\r\n\t\t\t                   .attr({x: this._x,\r\n\t\t\t                          y: this._y + this._style.borderSize, \r\n\t\t\t                          w: this._style.borderSize,\r\n\t\t\t                          h: this._h - (this._style.borderSize * 2),\r\n\t\t\t                          z: this._z + 1})\r\n\t\t\t                   .color(this._style.borderColor);\r\n\t\t\tthis.attach(this.edgeW);\r\n\t\t\tif(this._style.borderSkin != undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.edgeW.addComponent(\"Image\").image(this._style.borderSkin + \"/edge-w.png\", \"repeat-y\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n,\r\n\t_destroyBorders: function()\r\n\t{\r\n\t\tif(this.cornerNW != undefined) this.cornerNW.destroy();\r\n\t\tif(this.cornerNE != undefined) this.cornerNE.destroy();\r\n\t\tif(this.cornerSW != undefined) this.cornerSW.destroy();\r\n\t\tif(this.cornerSE != undefined) this.cornerSE.destroy();\r\n  \r\n\t\tif(this.edgeN != undefined) this.edgeN.destroy();\r\n\t\tif(this.edgeE != undefined) this.edgeE.destroy();\r\n\t\tif(this.edgeS != undefined) this.edgeS.destroy();\r\n\t\tif(this.edgeW != undefined) this.edgeW.destroy();\r\n\t}\r\n,\r\n\t_processStyle: function(style)\r\n\t{\r\n\t\tif(!style)\r\n\t\t{\r\n\t\t\tstyle = new Object();\r\n\t\t}\r\n\t\t\r\n\t\tif(style.foreground          == undefined) style.foreground          = \"#000000\";\r\n\t\tif(style.background          == undefined) style.background          = \"#FFFFFF\";\r\n\t\tif(style.alpha               == undefined) style.alpha               = 0.7;\r\n\t\tif(style.margin              == undefined) style.margin              = 0;\r\n\t\tif(style.padding             == undefined) style.padding             = 5;\r\n\t\tif(style.borderSize          == undefined) style.borderSize          = 2;\r\n\t\tif(style.borderColor         == undefined) style.borderColor         = \"#000000\";\r\n\t\tif(style.borderSkin          == undefined) style.borderSkin          = undefined;\r\n\t\tif(style.font                == undefined) style.font                = {};\r\n\t\tif(style.nextIndicatorSize   == undefined) style.nextIndicatorSize   = 5;\r\n\t\tif(style.nextIndicatorMargin == undefined) style.nextIndicatorMargin = 5;\r\n\t\t\r\n\t\treturn style;\r\n\t}\r\n});\r\n\r\n/*\r\n * Crafty WPTypewriter\r\n * Version 1.0\r\n *\r\n * Modified version:\r\n * Copyright 2013, Wagner Paz <wagner.o.paz@gmail.com>\r\n * Dual licensed under the MIT or GPL licenses.\r\n * \r\n * Original version:\r\n * Copyright 2012, Mike Sheldon <elleo@gnu.org>\r\n * Dual licensed under the MIT or GPL licenses.\r\n *\r\n * @trigger Change - when the text is changed\r\n * @trigger WPTypewriterFinished - when the typewriter animation finishes displaying all text\r\n */\r\nCrafty.c(\"WPTypewriter\",\r\n{\r\n\tinit : function()\r\n\t{\r\n\t\tthis._l = 1;\r\n\t\tthis.finished = false;\r\n\t\tthis.addComponent(\"Delay\");\r\n\t\tthis.addComponent(\"Text\");\r\n\t},\r\n\t\r\n\t/**@\r\n\t* #.write\r\n\t* @comp WPTypewriter\r\n\t* @sign public this.write(String sentence, String keysound, Number maxkeytime, Number minkeytime)\r\n\t* @param sentence - The string to write in the style of a typewriter, \"\\n\" characters will be replaced with <br />s.\r\n\t* @param keysound - A sound to make when each letter is displayed.\r\n\t* @param maxkeytime - Maximum amount of time between key presses.\r\n\t* @param minkeytime - Minimum amount of time between key presses.\r\n\t* \r\n\t* Writes out a string of text one character at a time in the style of a typewriter.\r\n\t*\r\n\t* If maxkeytime and minkeytime have different values then the amount of time\r\n\t* between key presses will be a randomised based on these two limits.\r\n\t* This allows for a more realistic simulation of typing.\r\n\t* \r\n\t* @example\r\n\t* ~~~\r\n\t* Crafty.audio.add(\"typekey\", [\r\n\t* \t\"audio/typewriter_key.ogg\"\r\n\t* ]);\r\n\t* Crafty.e(\"2D, DOM, WPTypewriter\").attr({w: 100, h: 20, x: 200, y: 280})\r\n\t* \t.write(\"Hello World!\", \"typekey\", 200, 100);\r\n\t* ~~~\r\n\t*/\r\n\twrite : function(sentence, keysound, maxkeytime, minkeytime)\r\n\t{\r\n        this.skipped  = false;\r\n\t\tthis.finished = false;\r\n\t\t\r\n\t\tkeydiff = maxkeytime - minkeytime;\r\n\t\tfor(var i = 0 ; i < sentence.length; i++)\r\n\t\t{\r\n\t\t\tthis.delay(function()\r\n\t\t\t{\r\n                if(!this.finished)\r\n                {\r\n                    if(this.skipped)\r\n                    {\r\n                        sentence = sentence.replace(/\\n/g, '<br/>');\r\n                        this._l = sentence.length;\r\n                    }\r\n                    else\r\n                    {\r\n                        if( this._l < sentence.length && sentence.charAt(this._l + 1) == '\\n' )\r\n                        {\r\n                            sentence = sentence.substr(0, this._l + 1) + \"<br/>\" + sentence.substr(this._l + 2, sentence.length);\r\n                            this._l += 5;\r\n                        }\r\n                \r\n                        Crafty.audio.play(keysound);\r\n                    }\r\n\t\t\t\t\r\n                    this.text(sentence.substr(0, this._l + 1));\r\n                    this._l++;\r\n                    \r\n                    if(this._l > sentence.length)\r\n                    {\r\n                        this._l = 1;\r\n                        this.finished = true;\r\n                        this.trigger(\"WPTypewriterFinished\");\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t}, i * maxkeytime - Math.random() * keydiff);\r\n\t\t}\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\n/*\r\n * Crafty WPBlink\r\n * Version 1.0\r\n *\r\n * Copyright 2013, Wagner Paz <wagner.o.paz@gmail.com>\r\n * Dual licensed under the MIT or GPL licenses.\r\n */\r\nCrafty.c(\"WPBlink\",\r\n{\r\n\tinit: function()\r\n\t{\r\n\t\tthis.requires(\"2D\");\r\n\t\tthis.requires(\"Delay\");\r\n\t}\r\n,\r\n\tblink: function(rate, opaqueAlpha, started)\r\n\t{\r\n\t\tthis._originalAlpha = this._alpha;\r\n\t\tthis._rate          = rate;\r\n\t\tthis._visible       = this._originalAlpha != 0.0;\r\n\t\tthis._stopped       = started     != undefined ? !started    : true;\r\n\t\tthis._opaqueAlpha   = opaqueAlpha != undefined ? opaqueAlpha : 1.0;\r\n\t\t\r\n\t\tthis._changeStateLoop();\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n,\r\n\tblinkStart: function()\r\n\t{\r\n\t\tthis.blink(this._rate, this._opaqueAlpha, true);\r\n\t\tthis._changeState();\r\n\t}\r\n,\r\n\tblinkStop: function()\r\n\t{\r\n\t\tthis.attr({alpha: this._originalAlpha});\r\n\t\tthis._stopped = true;\r\n\t}\r\n,\r\n\t_changeStateLoop: function()\r\n\t{\r\n\t\tif(!this._stopped)\r\n\t\t{\r\n\t\t\tthis.delay(function()\r\n\t\t\t{\r\n\t\t\t\tthis._changeState();\r\n\t\t\t\tthis._changeStateLoop();\r\n\t\t\t\t\r\n\t\t\t}, this._rate / 2);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.attr({alpha: this._originalAlpha});\r\n\t\t}\r\n\t}\r\n,\r\n\t_changeState: function()\r\n\t{\r\n\t\tthis._visible = !this._visible;\r\n\t\tthis.attr({alpha: this._visible ? this._opaqueAlpha : 0.0});\r\n\t\tif(this.__c[\"DOM\"])\r\n\t\t{\r\n\t\t\tthis.css('display', this._visible ? 'block' : 'none');\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/*\r\n * Crafty WPDynamicRender\r\n * Version 1.0\r\n *\r\n * Copyright 2013, Wagner Paz <wagner.o.paz@gmail.com>\r\n * Dual licensed under the MIT or GPL licenses.\r\n */\r\nCrafty.c(\"WPDynamicRender\",\r\n{\r\n\tdynamicRender: function(copyFrom)\r\n\t{\r\n\t\tif(copyFrom.__c[\"Canvas\"])\r\n\t\t{\r\n\t\t\tthis.addComponent(\"Canvas\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.addComponent(\"DOM\");\r\n\t\t}\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nCrafty.loadMessageBoxSkin = function(path, onComplete)\r\n{\r\n\tvar resources = [path + \"/corner-ne.png\"\r\n\t                ,path + \"/corner-nw.png\"\r\n\t                ,path + \"/corner-se.png\"\r\n\t                ,path + \"/corner-sw.png\"\r\n\t                ,path + \"/edge-n.png\"\r\n\t                ,path + \"/edge-e.png\"\r\n\t                ,path + \"/edge-s.png\"\r\n\t                ,path + \"/edge-w.png\"];\r\n\t\r\n\tCrafty.load(resources, onComplete);\r\n};"]],"start1":0,"start2":0,"length1":0,"length2":17398}]],"length":17398}
